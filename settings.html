<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Settings - mentat</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <p><a href="index.html" class="back-link">← back</a></p>
    <h1>Settings</h1>
    <div class="divider"><div class="timer-progress"></div></div>

    <section class="stats-section">
      <h2>Key Bindings</h2>
      <p class="settings-desc">Map keyboard keys to numbers (useful without numpad)</p>

      <div class="keybind-grid">
        <div class="keybind-row">
          <label class="keybind-item">
            <span class="keybind-num">7</span>
            <input type="text" maxlength="1" class="keybind-input" data-num="7">
          </label>
          <label class="keybind-item">
            <span class="keybind-num">8</span>
            <input type="text" maxlength="1" class="keybind-input" data-num="8">
          </label>
          <label class="keybind-item">
            <span class="keybind-num">9</span>
            <input type="text" maxlength="1" class="keybind-input" data-num="9">
          </label>
        </div>
        <div class="keybind-row">
          <label class="keybind-item">
            <span class="keybind-num">4</span>
            <input type="text" maxlength="1" class="keybind-input" data-num="4">
          </label>
          <label class="keybind-item">
            <span class="keybind-num">5</span>
            <input type="text" maxlength="1" class="keybind-input" data-num="5">
          </label>
          <label class="keybind-item">
            <span class="keybind-num">6</span>
            <input type="text" maxlength="1" class="keybind-input" data-num="6">
          </label>
        </div>
        <div class="keybind-row">
          <label class="keybind-item">
            <span class="keybind-num">1</span>
            <input type="text" maxlength="1" class="keybind-input" data-num="1">
          </label>
          <label class="keybind-item">
            <span class="keybind-num">2</span>
            <input type="text" maxlength="1" class="keybind-input" data-num="2">
          </label>
          <label class="keybind-item">
            <span class="keybind-num">3</span>
            <input type="text" maxlength="1" class="keybind-input" data-num="3">
          </label>
        </div>
        <div class="keybind-row">
          <span class="keybind-spacer"></span>
          <label class="keybind-item">
            <span class="keybind-num">0</span>
            <input type="text" maxlength="1" class="keybind-input" data-num="0">
          </label>
          <label class="keybind-item">
            <span class="keybind-num">⌫</span>
            <input type="text" maxlength="1" class="keybind-input" data-num="backspace">
          </label>
        </div>
      </div>

      <button onclick="clearBindings()" class="clear-btn">Clear All</button>
      <button onclick="window.location.href='practice.html'" class="clear-btn">Try Keybindings</button>
    </section>

    <section class="stats-section">
      <h2>Debug Mode</h2>
      <p class="settings-desc">Infinite time, manual difficulty controls, detailed stats</p>
      <label class="debug-toggle-label">
        <input type="checkbox" id="debug-checkbox" onchange="toggleDebug()">
        <span>Enable debug mode</span>
      </label>
    </section>
  </div>

  <script>
    let keyBindings = JSON.parse(localStorage.getItem('keyBindings')) || {};

    // Load saved bindings into inputs
    document.querySelectorAll('.keybind-input').forEach(input => {
      const num = input.dataset.num;
      // Find the key that maps to this number
      for (const [key, value] of Object.entries(keyBindings)) {
        if (value === num) {
          input.value = key;
          break;
        }
      }

      // Select text on focus for easy replacement
      input.addEventListener('focus', () => {
        input.select();
      });

      // Save on input
      input.addEventListener('input', () => {
        const key = input.value.toLowerCase();
        input.value = key;

        // Remove old binding for this number
        for (const [k, v] of Object.entries(keyBindings)) {
          if (v === num) {
            delete keyBindings[k];
          }
        }

        // Remove if this key was bound to another number
        if (key && keyBindings[key]) {
          const oldNum = keyBindings[key];
          document.querySelector(`.keybind-input[data-num="${oldNum}"]`).value = '';
        }

        // Set new binding
        if (key) {
          keyBindings[key] = num;

          // Move to next input
          const inputs = Array.from(document.querySelectorAll('.keybind-input'));
          const currentIndex = inputs.indexOf(input);
          if (currentIndex < inputs.length - 1) {
            inputs[currentIndex + 1].focus();
          }
        }

        localStorage.setItem('keyBindings', JSON.stringify(keyBindings));
      });
    });

    function clearBindings() {
      keyBindings = {};
      localStorage.setItem('keyBindings', JSON.stringify(keyBindings));
      document.querySelectorAll('.keybind-input').forEach(input => {
        input.value = '';
      });
    }

    // Debug mode toggle
    const debugCheckbox = document.getElementById('debug-checkbox');
    debugCheckbox.checked = localStorage.getItem('debugMode') === 'true';

    function toggleDebug() {
      localStorage.setItem('debugMode', debugCheckbox.checked);
    }
  </script>
</body>
</html>
